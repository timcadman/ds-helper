<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conducting mixed effect/trajectory analysis using DataSHIELD • dsHelper</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Conducting mixed effect/trajectory analysis using DataSHIELD">
<meta property="og:description" content="dsHelper">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsHelper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ds-helper-main-vignette.html">Descriptive functions</a>
    </li>
    <li>
      <a href="../articles/ds-helper-trajectories-vignette.html">Conducting mixed effect/trajectory analysis using DataSHIELD</a>
    </li>
    <li>
      <a href="../articles/TROUBLESHOOTING.html">Troubeshooting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lifecycle-project/ds-helper/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Conducting mixed effect/trajectory analysis
using DataSHIELD</h1>
                        <h4 data-toc-skip class="author">Tim Cadman</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lifecycle-project/ds-helper/blob/HEAD/vignettes/ds-helper-trajectories-vignette.Rmd" class="external-link"><code>vignettes/ds-helper-trajectories-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>ds-helper-trajectories-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>This tutorial will demonstrate how to model trajectories in
DataSHIELD using repeated measures data from multiple cohorts.</p>
<p>This tutorial draws on the following papers/tutorials:</p>
<ol style="list-style-type: decimal">
<li><p>Hughes, R., Tilling, K. &amp; Lawlor, D. Combining longitudinal
data from different cohorts to examine the life-course trajectory.
Preprint available on medrxiv: <a href="https://doi.org/10.1101/2020.11.24.20237669" class="external-link uri">https://doi.org/10.1101/2020.11.24.20237669</a></p></li>
<li><p>Tilling K, Macdonald-Wallis C, Lawlor DA, Hughes RA, Howe LD.
Modelling childhood growth using fractional polynomials and linear
splines. Ann Nutr Metab. 2014;65(2-3):129-38. <a href="https://doi.org/10.1159/000362695" class="external-link uri">https://doi.org/10.1159/000362695</a>.</p></li>
<li><p>Centre for Multilevel Modelling online course. <a href="http://www.bristol.ac.uk/cmm/learning/online-course/" class="external-link uri">http://www.bristol.ac.uk/cmm/learning/online-course/</a></p></li>
</ol>
<p>You will use simulated data to replicate part of the analysis from
Hughes et al. cited above. It would be helpful to read this tutorial in
conjuncture with this paper.</p>
<p>Please note that not all the methods used in Hughes et al. are
available in DataSHIELD. Currently it is not possible to use (i)
multiple imputation, (ii) spline models, or (iii) 1-stage meta-analysis
of mixed effects models. All of these are in the pipeline and this
tutorial will be extended when these methods become available.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>We will be working with simulated repeated measures data for four
cohorts: (i) Alspac, (ii) BCG, (iii) Born in Bradford &amp; (iv)
Probit.</p>
</div>
<div class="section level3">
<h3 id="aims-of-the-analysis">Aims of the analysis<a class="anchor" aria-label="anchor" href="#aims-of-the-analysis"></a>
</h3>
<p>Our research aims for today are:</p>
<ol style="list-style-type: decimal">
<li>To model child weight trajectories over time for four cohorts</li>
<li>To model sex differences in weight trajectories</li>
<li>To combine these trajectories by 2-stage meta-analysis</li>
</ol>
<p>Let’s get started.</p>
</div>
</div>
<div class="section level2">
<h2 id="installing-and-loading-packages">Installing and loading packages<a class="anchor" aria-label="anchor" href="#installing-and-loading-packages"></a>
</h2>
<p>First you need to install some packages are used in tutorial. Even if
you have previously installed them it is worth doing this again to
ensure that you have the latest versions.</p>
<p>If prompted to update packages, select option ‘none’.</p>
<p>First install the package ‘remotes’ which contains the function
‘install_github’.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"datashield/DSI"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"datashield/dsBaseClient"</span>, ref <span class="op">=</span> <span class="st">"v6.2-dev"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"lifecycle-project/ds-helper"</span>, ref <span class="op">=</span> <span class="st">"traj-fun"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"DSMolgenisArmadillo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre></div>
<p>Now we load these packages.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsBaseClient</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/molgenis/molgenis-r-datashield/" class="external-link">DSMolgenisArmadillo</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lifecycle-project/ds-helper/" class="external-link">dsHelper</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>A couple of things to note:</p>
<ol style="list-style-type: decimal">
<li><p>I use a lot of the tidyverse packages as I find them very
efficient and they make the code more readable. If any syntax is unclear
just ask!</p></li>
<li><p>I also use a number of functions from a package called dsHelper.
This was written by me and Sido Haakma to make analysis in DataSHIELD
more straightforward. Any problems with these functions just let us
know.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="logging-in-and-assigning-data">Logging in and assigning data<a class="anchor" aria-label="anchor" href="#logging-in-and-assigning-data"></a>
</h2>
<p>The simulated data is held on a remote server. To access it, you
first request a ‘token’ which contains the login details. You then use
this to login and assign the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://molgenis.github.io/molgenis-r-datashield/reference/armadillo.get_token.html" class="external-link">armadillo.get_token</a></span><span class="op">(</span><span class="st">"https://armadillo.test.molgenis.org"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: Real HTTP connections are disabled.</span></span>
<span><span class="co">## Unregistered request:</span></span>
<span><span class="co">##   GET:  https://armadillo.test.molgenis.org/actuator/info   with headers {Accept: application/json, text/xml, application/xml, */*}</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## You can stub this request with the following snippet:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    stub_request('get', uri = 'https://armadillo.test.molgenis.org/actuator/info') %&gt;%</span></span>
<span><span class="co">##      wi_th(</span></span>
<span><span class="co">##        headers = list('Accept' = 'application/json, text/xml, application/xml, */*')</span></span>
<span><span class="co">##      )</span></span>
<span><span class="co">## ============================================================</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>server <span class="op">=</span> <span class="st">"alspac"</span>,</span>
<span>url <span class="op">=</span> <span class="st">"https://armadillo.test.molgenis.org"</span>,</span>
<span>table <span class="op">=</span> <span class="st">"mlmalspac/tutorial/data"</span>,</span>
<span>token <span class="op">=</span> <span class="va">token</span>,</span>
<span>driver <span class="op">=</span> <span class="st">"ArmadilloDriver"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in data.frame(server = as.character(server), url = as.character(url), : object 'token' not found</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>server <span class="op">=</span> <span class="st">"bcg"</span>,</span>
<span>url <span class="op">=</span> <span class="st">"https://armadillo.test.molgenis.org"</span>,</span>
<span>table <span class="op">=</span> <span class="st">"mlmbcg/tutorial/data"</span>,</span>
<span>token <span class="op">=</span> <span class="va">token</span>,</span>
<span>driver <span class="op">=</span> <span class="st">"ArmadilloDriver"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in data.frame(server = as.character(server), url = as.character(url), : object 'token' not found</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>server <span class="op">=</span> <span class="st">"bib"</span>,</span>
<span>url <span class="op">=</span> <span class="st">"https://armadillo.test.molgenis.org"</span>,</span>
<span>table <span class="op">=</span> <span class="st">"mlmbib/tutorial/data"</span>,</span>
<span>token <span class="op">=</span> <span class="va">token</span>,</span>
<span>driver <span class="op">=</span> <span class="st">"ArmadilloDriver"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in data.frame(server = as.character(server), url = as.character(url), : object 'token' not found</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>server <span class="op">=</span> <span class="st">"probit"</span>,</span>
<span>url <span class="op">=</span> <span class="st">"https://armadillo.test.molgenis.org"</span>,</span>
<span>table <span class="op">=</span> <span class="st">"mlmprobit/tutorial/data"</span>,</span>
<span>token <span class="op">=</span> <span class="va">token</span>,</span>
<span>driver <span class="op">=</span> <span class="st">"ArmadilloDriver"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in data.frame(server = as.character(server), url = as.character(url), : object 'token' not found</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logindata</span> <span class="op">&lt;-</span> <span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span>logins <span class="op">=</span> <span class="va">logindata</span>, assign <span class="op">=</span> <span class="cn">TRUE</span>, symbol <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in options[[i]]: subscript out of bounds</span></span></code></pre>
<p>We can check that this has worked. You should see that each cohort
has one dataframe called “data”, which contains 7 variables.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"data"</span>, datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<p>We wont be using all of the variables today, however if you want to
come back and use this data to try out more complicated models we’ll
keep it online.</p>
</div>
<div class="section level2">
<h2 id="part-1-visualising-the-data">PART 1: VISUALISING THE DATA<a class="anchor" aria-label="anchor" href="#part-1-visualising-the-data"></a>
</h2>
<div class="section level3">
<h3 id="scatter-plots-of-child-weight-by-age">Scatter plots of child weight by age<a class="anchor" aria-label="anchor" href="#scatter-plots-of-child-weight-by-age"></a>
</h3>
<p>Let’s start off by looking at our repeated measures weight data for
each cohort. We can make scatter plots with age on the x-axis and weight
on the y-axis.</p>
<p>Note that the values that you see are anonymised - they are a
non-disclosive approximation of the original values.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.scatterPlot.html" class="external-link">ds.scatterPlot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"data$age"</span>, y <span class="op">=</span> <span class="st">"data$weight"</span>, datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<p>What are you initial thoughts about the data?</p>
</div>
<div class="section level3">
<h3 id="mean-observed-weight-by-age">Mean observed weight by age<a class="anchor" aria-label="anchor" href="#mean-observed-weight-by-age"></a>
</h3>
<p>Another way to visualise the weight data is to split child age into
yearly intervals, and plot the mean on the y-axis with age on the x-axis
(see Figure 2 from Hughes et al.).</p>
<p>First of all we need to calculate the mean values for weight at each
yearly age band:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meanage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dsHelper-defunct.html">dh.meanByAge</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>    outcome <span class="op">=</span> <span class="st">"weight"</span>, </span>
<span>    age_var <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>    conns <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: 'dh.meanByAge' has been removed from this package. </span></span>
<span><span class="co">##     Use dh.meanByAge instead. See help('Defunct')</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meanage</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'print': object 'meanage' not found</span></span></code></pre>
<p>Now we have the values locally, we can use any r package to plot
these. I like to use ggplot:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#264653"</span>, <span class="st">"#2a9d8f"</span>, <span class="st">"#E9C46A"</span>, <span class="st">"#F4A261"</span>, <span class="st">"#E76F51"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meanage.plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">meanage</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">mean</span>, colour <span class="op">=</span> <span class="va">cohort</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Child age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Observed weight (KG)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in fortify(data): object 'meanage' not found</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meanage.plot</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'meanage.plot' not found</span></span></code></pre>
<p>Q: Looking at these two plots, What are your initial thoughts about
the pattern of weight change over time?</p>
</div>
<div class="section level3">
<h3 id="describing-the-exposures">Describing the exposures<a class="anchor" aria-label="anchor" href="#describing-the-exposures"></a>
</h3>
<p>DataSHIELD contains the functions ds.summary and ds.table which can
be used to describe continuous and categorical variables. However, the
output of these is a little tricky to work with. Instead we can use the
function ‘dh.getStats’ to extract descriptives in a more usable
format.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.getStats.html">dh.getStats</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>    vars <span class="op">=</span> <span class="st">"sex"</span>, </span>
<span>    conns <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'stats' not found</span></span></code></pre>
<p>This gives us a list with two elements corresponding to the
continuous and categorical variables. As we didn’t request stats for any
continuous variables, the first list is empty.</p>
</div>
<div class="section level3">
<h3 id="some-more-descriptives-that-are-useful-to-have">Some more descriptives that are useful to have<a class="anchor" aria-label="anchor" href="#some-more-descriptives-that-are-useful-to-have"></a>
</h3>
<p>There are other bits of information it is useful to report:</p>
<ul>
<li>Total number of observations</li>
<li>Total number of participants</li>
<li>Min and max age of participants</li>
<li>Median number of measurements per individual</li>
</ul>
<p>We can use the function dh.getRmStats to extract this info. Note that
the min and max ages are based on the 5th and 95th percentiles as
DataSHIELD doesn’t will not return true minimum and maximums due to
disclosure issues.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rm_stats</span> <span class="op">&lt;-</span> <span class="fu">dh.getRmStats</span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>    outcome <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>    id_var <span class="op">=</span> <span class="st">"id"</span>, </span>
<span>    age_var <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>    conns <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.getRmStats(df = "data", outcome = "weight", id_var = "id", : could not find function "dh.getRmStats"</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rm_stats</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'rm_stats' not found</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="part-2-fitting-a-simple-linear-trajectory">PART 2: FITTING A SIMPLE LINEAR TRAJECTORY<a class="anchor" aria-label="anchor" href="#part-2-fitting-a-simple-linear-trajectory"></a>
</h2>
<div class="section level3">
<h3 id="trajectory-models-prep">Trajectory models: prep<a class="anchor" aria-label="anchor" href="#trajectory-models-prep"></a>
</h3>
<p>Before we can get started, we need to make sure that our id variable
is an integer. If we don’t, it breaks. First we create a new object
which is an integer version of our ID. We then join this back to our
main dataframe.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.asInteger.html" class="external-link">ds.asInteger</a></span><span class="op">(</span></span>
<span>    x.name <span class="op">=</span> <span class="st">"data$id"</span>, </span>
<span>    newobj <span class="op">=</span> <span class="st">"id_int"</span>, </span>
<span>  datasources   <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.cbind.html" class="external-link">ds.cbind</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"id_int"</span><span class="op">)</span>,</span>
<span>    newobj <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  datasources   <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="specifying-the-model">Specifying the model<a class="anchor" aria-label="anchor" href="#specifying-the-model"></a>
</h3>
<p>First we fit a model with weight predicted by four terms: an
intercept (1), age, sex and the interaction between age and sex. These
terms are our ‘fixed effects’, and comprise the first half of the
formula below. They are specified in the same way as you would write a
formula in a standard regression model.</p>
<p>In the second half of the formula below we specify our random
effects. This is where we provide information about how we believe the
data to be clustered.</p>
<p>The variable to the right of the vertical line is our ID variable.
This specifies that we want to treat each invidual as a separate
cluster, because we believe their measurements will be correlated. This
is a plausible hypothesis: for example if my height is a lot higher than
average at age 5, it is likely to also be higher than average at age 10.
We can describe this as a 2-level clustering, with weight measurements
(level 1) clustered within individuals (level 2).</p>
<p>The variables to the left of the vertical line specify which extra
parameters we want to estimate for each individual. Or to put it another
way, it specifies which parameters we allow to vary for each
individual.</p>
<p>If we just specify “1”, then in addition to calculating an overall
intercept, we also calculate an intercept for each individual. This
provides us with information about the variability between individuals
in their starting weight. This is called a random intercept model.</p>
<p>If we specifed “1 + age”, then in addition we would calculate a
separate slope for each individual. This would provide us with
information about how the gradient of the trajectory varies between
individuals. This is called a random slope model.</p>
<p>Here we start with a random intercept model. Understand what you are
doing is the difficult bit; fitting the model is straightfoward:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.lmerSLMA.html" class="external-link">ds.lmerSLMA</a></span><span class="op">(</span></span>
<span>    dataName <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  formula <span class="op">=</span> <span class="st">"weight ~ 1 + age + sex + age*sex + (1|id_int)"</span>, </span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.fit</span><span class="op">$</span><span class="va">output.summary</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'model1.fit' not found</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="exploring-the-output">Exploring the output<a class="anchor" aria-label="anchor" href="#exploring-the-output"></a>
</h3>
<p>We can see the coefficients for the fixed and random parts of our
model directly from the model object.</p>
<p>Fixed effects coefficients for each cohort are here:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.fit</span><span class="op">$</span><span class="va">betamatrix.valid</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'model1.fit' not found</span></span></code></pre>
<p>The pooled estimates are here:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.fit</span><span class="op">$</span><span class="va">SLMA.pooled.ests.matrix</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'model1.fit' not found</span></span></code></pre>
<p>And the details of the random effects are here:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.fit</span><span class="op">$</span><span class="va">output.summary</span><span class="op">$</span><span class="va">study1</span><span class="op">$</span><span class="va">varcor</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'model1.fit' not found</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="a-neater-way">A neater way<a class="anchor" aria-label="anchor" href="#a-neater-way"></a>
</h3>
<p>I find these objects a little fiddly to work with (you may not). You
can also use the dsHelper function to extract the coefficients.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.lmTab.html">dh.lmTab</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">model1.fit</span>, </span>
<span>    type <span class="op">=</span> <span class="st">"lmer"</span>, </span>
<span>    coh_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">conns</span><span class="op">)</span>, </span>
<span>    ci_format <span class="op">=</span> <span class="st">"separate"</span>, </span>
<span>    direction <span class="op">=</span> <span class="st">"wide"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in isTRUE(lhs): object 'model1.fit' not found</span></span></code></pre>
<p>Let’s explore there in more detail</p>
<div class="section level4">
<h4 id="fixed-effects">Fixed effects<a class="anchor" aria-label="anchor" href="#fixed-effects"></a>
</h4>
<p>The fixed effects are analogous to your coefficients from a linear
regression model.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.coef</span><span class="op">$</span><span class="va">fixed</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'model1.coef' not found</span></span></code></pre>
<p>If we use dh.lmTab it allows us to manipulate our output more easily.
For example you might want to split the fixed effects by cohort:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.coef</span><span class="op">$</span><span class="va">fixed</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">cohort</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">group_split</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in group_by(., cohort): object 'model1.coef' not found</span></span></code></pre>
<p>Or you might want to just select the pooled results:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.coef</span><span class="op">$</span><span class="va">fixed</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dplyr::filter(., cohort == "combined"): object 'model1.coef' not found</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="random-effects">Random effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h4>
<p>When the model if fit, group (level 2) residuals are calculated for
each subject. These represent the difference between interecept of each
subject and the mean intercept for the sample.</p>
<p>However, there are not returned by DataSHIELD as they could be
disclosive. Instead we can view the standard deviation of these
residuals:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.coef</span><span class="op">$</span><span class="va">random_sd</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'model1.coef' not found</span></span></code></pre>
<p>If we take ALSPAC as an example, we have an overall (mean) intercept
of 3.87, and a standard deviation of 3.84. This indicates considerable
variability between individual intercepts. If you had specified more
than one random effect (e.g. slope) this would also be displayed here.
You could also view the correlation between your random effects
(output$random_cor).</p>
<p>We can also see the standard deviation of the residual error, ie the
difference between observed values and predicted values within
subject.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1.coef</span><span class="op">$</span><span class="va">resid_sd</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'model1.coef' not found</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="plotting-the-trajectories">Plotting the trajectories<a class="anchor" aria-label="anchor" href="#plotting-the-trajectories"></a>
</h3>
<p>In order to plot trajectories, we first need to get model predicted
values of weight. In order to do this, we need to create a dataframe
with the values of the fixed effects at which we want to predict values
of weight. The names of the columns of this new dataframe need to
correspond to the names of the coefficients in the output above.</p>
<p>We want to visualise the trajectories for both males and females
between ages 0 and 25. In our reference dataframe, we therefore create
values for age between 0 and 25 at 0.1 intervals, repeated for sex == 0
(males) and sex == 1 (females).</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_data_m</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>    <span class="st">"age:sex1"</span> <span class="op">=</span> <span class="va">age</span><span class="op">*</span><span class="fl">0</span>,</span>
<span>    sex1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_data_f</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.11</span><span class="op">)</span>, </span>
<span>    <span class="st">"age:sex1"</span> <span class="op">=</span> <span class="va">age</span><span class="op">*</span><span class="fl">1</span>,</span>
<span>    sex1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_data</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">new_data_m</span>, <span class="va">new_data_f</span><span class="op">)</span></span></code></pre></div>
<p>If we look at this object we have created, it has all the values of
the model variables at which we want to predict weight:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_data</span></span></code></pre></div>
<p>We can then use this reference data and our model object to get
predicted values. Note that we now have four more columns appended to
our reference data containing predicted values, standard error of
predictions and confidence intervals.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.predictLmer.html">dh.predictLmer</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">model1.fit</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">pred_data</span>,</span>
<span>    coh_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">conns</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.predictLmer(model = model1.fit, newdata = pred_data, coh_names = names(conns)): object 'model1.fit' not found</span></span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotdata</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'plotdata' not found</span></span></code></pre>
<p>Nice, we’re getting there. One thing to address is that currently we
have predicted values for all cohorts between ages 0 and 25. However
many of the cohorts don’t have data between those ages, so we might not
want to plot beyond where there is data. We can trim our predicted data
to the available ages.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_trim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.trimPredData.html">dh.trimPredData</a></span><span class="op">(</span></span>
<span>    pred <span class="op">=</span> <span class="va">plotdata</span>,</span>
<span>    coh_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alspac"</span>, <span class="st">"bcg"</span>, <span class="st">"bib"</span>, <span class="st">"probit"</span>, <span class="st">"combined"</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.trimPredData(pred = plotdata, coh_names = c("alspac", "bcg", : object 'plotdata' not found</span></span></code></pre>
<p>Next we set sex as a factor to make the plot clearer:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_trim</span> <span class="op">&lt;-</span> <span class="va">plot_trim</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">mutate</span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sex1</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in mutate(., sex = factor(sex1, levels = c(0, 1), labels = c("Male", : object 'plot_trim' not found</span></span></code></pre>
<p>It would also be nice to be able to overlay the predicted trajectory
with the observed values. Remember earlier we made a scatter plot using
DataSHIELD? We can extract the anonymised values which were used in that
plot and store them as a local object. This allows us to build more
flexible plots.</p>
<p>Each row of the created object represents the anomyised values of a
subject.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.getAnonPlotData.html">dh.getAnonPlotData</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>    v1 <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>    v2 <span class="op">=</span> <span class="st">"weight"</span>, </span>
<span>    conns <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.getAnonPlotData(df = "data", v1 = "age", v2 = "weight", conns = conns): unused arguments (v1 = "age", v2 = "weight")</span></span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'observed' not found</span></span></code></pre>
<p>Now we are ready to plot the pooled trajectories. We use the function
“sample_frac” to only take 1% of the observed values. You can play
around with this value, but if you use too many the graph becomes
unreadable.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">sample_frac</span><span class="op">(</span><span class="va">observed</span>, <span class="fl">.01</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">plot_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">predicted</span>, colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">plot_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">plot_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Child age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Predicted weight (KG)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in sample_frac(observed, 0.01): object 'observed' not found</span></span></code></pre>
<p>We can also plot the trajectories for each cohort separately:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">sample_frac</span><span class="op">(</span><span class="va">observed</span>, <span class="fl">.01</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">plot_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">predicted</span>, colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">plot_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">plot_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">cohort</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Child age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Predicted weight (KG)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in sample_frac(observed, 0.01): object 'observed' not found</span></span></code></pre>
<p>Q: Looking at the plots, how well do you think our model fits the
data?</p>
</div>
</div>
<div class="section level2">
<h2 id="part-3-fitting-a-non-linear-trajectory-using-a-transformation-of-the-age-term">PART 3: FITTING A NON-LINEAR TRAJECTORY USING A TRANSFORMATION OF
THE AGE TERM<a class="anchor" aria-label="anchor" href="#part-3-fitting-a-non-linear-trajectory-using-a-transformation-of-the-age-term"></a>
</h2>
<p>The previous model doesn’t look great to me, especially around age 5
where there looks to be a distinct non-linearity in the trajectory which
we are not capturing.</p>
<p>One way to address this is to model weight not as a function of age,
but as a function of a transformation of age.</p>
<p>Let’s start by creating a new variable which is age^2, and see if
this provides a better fit. We create the variable, and join it back in
our main data frame.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.make.html" class="external-link">ds.make</a></span><span class="op">(</span></span>
<span>    toAssign <span class="op">=</span> <span class="st">"data$age^2"</span>, </span>
<span>    newobj <span class="op">=</span> <span class="st">"age_2"</span>, </span>
<span>    datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.dataFrame.html" class="external-link">ds.dataFrame</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"age_2"</span><span class="op">)</span>, </span>
<span>    newobj <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>    datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<p>Now we are going to simply repeat the steps before, but using this
transformed variable instead of the original age variable.</p>
<p>First we run the model:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_2.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.lmerSLMA.html" class="external-link">ds.lmerSLMA</a></span><span class="op">(</span></span>
<span>    dataName <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  formula <span class="op">=</span> <span class="st">"weight ~ 1 + age_2 + sex + age_2*sex + (1|id_int)"</span>, </span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<p>Now we create a dataframe of the values of the fixed effects at which
we want to predict weight. Note that as we have transformed our age
term, we need to add this transformed version of the variable to our
reference data.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_ref_2a</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>    age_2 <span class="op">=</span> <span class="va">age</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>    <span class="st">"age_2:sex1"</span> <span class="op">=</span> <span class="va">age_2</span><span class="op">*</span><span class="fl">0</span>,</span>
<span>    sex1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_ref_2b</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.11</span><span class="op">)</span>, </span>
<span>    age_2 <span class="op">=</span> <span class="va">age</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>    <span class="st">"age_2:sex1"</span> <span class="op">=</span> <span class="va">age_2</span><span class="op">*</span><span class="fl">1</span>,</span>
<span>    sex1 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_ref_2</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">pred_ref_2a</span>, <span class="va">pred_ref_2b</span><span class="op">)</span></span></code></pre></div>
<p>Again we get the predicted values, trim them at the ages of the
observed data and set sex as a factor.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.predictLmer.html">dh.predictLmer</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">age_2.fit</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">pred_ref_2</span>,</span>
<span>    coh_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">conns</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.predictLmer(model = age_2.fit, newdata = pred_ref_2, coh_names = names(conns)): object 'age_2.fit' not found</span></span></code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_data_2_trim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.trimPredData.html">dh.trimPredData</a></span><span class="op">(</span></span>
<span>    pred <span class="op">=</span> <span class="va">pred_data_2</span>,</span>
<span>    coh_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alspac"</span>, <span class="st">"bcg"</span>, <span class="st">"bib"</span>, <span class="st">"probit"</span>, <span class="st">"combined"</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.trimPredData(pred = pred_data_2, coh_names = c("alspac", "bcg", : object 'pred_data_2' not found</span></span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_data_2_trim</span> <span class="op">&lt;-</span> <span class="va">pred_data_2_trim</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">mutate</span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sex1</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in mutate(., sex = factor(sex1, levels = c(0, 1), labels = c("Male", : object 'pred_data_2_trim' not found</span></span></code></pre>
<p>Let’s plot this against the observed data and see if it fits any
better:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">sample_frac</span><span class="op">(</span><span class="va">observed</span>, <span class="fl">.01</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred_data_2_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">predicted</span>, colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Child age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Predicted weight"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in sample_frac(observed, 0.01): object 'observed' not found</span></span></code></pre>
<p>Hmmm. We now have a non-linear trajectory, but it still doesn’t look
a great fit. We haven’t looked at any fit statistics or residuals yet,
but from the eye it clearly doesn’t fit the data. It also doesn’t seem
to capture the sex differences we would expect. We can do better than
this.</p>
</div>
<div class="section level2">
<h2 id="part-4-fractional-polynomials">PART 4: FRACTIONAL POLYNOMIALS<a class="anchor" aria-label="anchor" href="#part-4-fractional-polynomials"></a>
</h2>
<p>Using one transformation of age allowed one ‘bend’ in the trajectory.
However, the problem we saw with the previous model is that natural
growth trajectories often have multiple bends.</p>
<p>One way to model this is to use two transformations of age
(e.g. age^2 and age^0.5). These are called fractional polynomials
(powers which involve fractions). You could use more than 2
transformations: this would give you a better model fit, but with
greater risk of overfitting your model. Here we will stick two.</p>
<p>Even with only two transformations of age, there are infinite number
of possible combinations. How do we chose which to use?</p>
<p>You may have a good a priori reason to chose a combination of terms.
If you don’t, one reasonable approach is to select a certain set of
transformations, and fit every combination of those. We can then see
which combination of age terms provides the best model fit.</p>
<div class="section level3">
<h3 id="preparing-the-data-for-modelling">Preparing the data for modelling<a class="anchor" aria-label="anchor" href="#preparing-the-data-for-modelling"></a>
</h3>
<div class="section level4">
<h4 id="remove-values-of-zero">Remove values of zero<a class="anchor" aria-label="anchor" href="#remove-values-of-zero"></a>
</h4>
<p>Transforming values of zero will create infinite values which will
break our models. We add a small quantity to our age variable to avoid
this.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.assign.html" class="external-link">ds.assign</a></span><span class="op">(</span></span>
<span>    toAssign <span class="op">=</span> <span class="st">"data$age+0.01"</span>, </span>
<span>    newobj <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.dropCols.html">dh.dropCols</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>    vars <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>    type <span class="op">=</span> <span class="st">"remove"</span>, </span>
<span>    new_df_name <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  conns <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.cbind.html" class="external-link">ds.cbind</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"age"</span><span class="op">)</span>, </span>
<span>    newobj <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="create-transformations-of-age-term">Create transformations of age term<a class="anchor" aria-label="anchor" href="#create-transformations-of-age-term"></a>
</h4>
<p>We could do the transformations manually, but this would be a bit
cumbersome. We can insted use the function ds.makeAgePolys to create
transformations of age. Here we use the following powers: -2, -1, -0.5,
log, 0.5, 2, 3.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.makeAgePolys.html">dh.makeAgePolys</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>    agevars <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>    poly_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m_2"</span>, <span class="st">"m_1"</span>, <span class="st">"m_0_5"</span>, <span class="st">"log"</span>, <span class="st">"0_5"</span>, <span class="st">"2"</span>, <span class="st">"3"</span><span class="op">)</span>, </span>
<span>    poly_form <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"^-2"</span>, <span class="st">"^-1"</span>, <span class="st">"^-0.5"</span>, <span class="st">"log"</span>, <span class="st">"^0.5"</span>, <span class="st">"^2"</span>, <span class="st">"^3"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: `age_var` must not be NULL.</span></span></code></pre>
<p>We can check this has worked, and see the mean values for these new
variables.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.getStats.html">dh.getStats</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"agem_2"</span>, <span class="st">"agem_1"</span>, <span class="st">"agem_0_5"</span>, <span class="st">"logage"</span>, <span class="st">"age0_5"</span>, <span class="st">"age2"</span>, <span class="st">"age3"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly_summary</span><span class="op">$</span><span class="va">continuous</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">select</span><span class="op">(</span><span class="va">cohort</span>, <span class="va">variable</span>, <span class="va">mean</span>, <span class="va">std.dev</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'print': object 'poly_summary' not found</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="identifying-the-best-fitting-model">Identifying the best fitting model<a class="anchor" aria-label="anchor" href="#identifying-the-best-fitting-model"></a>
</h3>
<p>Ok, so now we have a load of transformations of our age in term in
the dataframe “data”. Next we want to fit models for each paired
combination of these terms. Again, we could do this by writing out
ds.lmerSLMA 28 times, but this brings a fair chance that you make an
error in the code.</p>
<p>I’ve written a couple more functions to streamline the process.</p>
<div class="section level4">
<h4 id="create-model-formulae">Create model formulae<a class="anchor" aria-label="anchor" href="#create-model-formulae"></a>
</h4>
<p>‘dh.makeLmerForm’ creates the model formulae based on the age terms
you have created. The argument to “agevars” is a vector of variable
names corresponding to the age transformations we created above.</p>
<p>First we try to find the best shape of trajectory, so we create model
formulae just with the age terms.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_form</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.makeLmerForm.html">dh.makeLmerForm</a></span><span class="op">(</span></span>
<span>  outcome <span class="op">=</span> <span class="st">"weight"</span>, </span>
<span>  idvar <span class="op">=</span> <span class="st">"id_int"</span>, </span>
<span>  agevars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"agem_2"</span>, <span class="st">"agem_1"</span>, <span class="st">"agem_0_5"</span>, <span class="st">"logage"</span>, <span class="st">"age0_5"</span>, <span class="st">"age2"</span>, <span class="st">"age3"</span><span class="op">)</span>, </span>
<span>  random <span class="op">=</span> <span class="st">"intercept"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.makeLmerForm(outcome = "weight", idvar = "id_int", agevars = c("age", : unused arguments (idvar = "id_int", agevars = c("age", "agem_2", "agem_1", "agem_0_5", "logage", "age0_5", "age2", "age3"))</span></span></code></pre>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight_form</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in head(., 10): object 'weight_form' not found</span></span></code></pre>
<p>This has created a table where each row (a total of 28) contains the
formula for a mixed effects model with a different combination of the
fractional polynomials.</p>
</div>
</div>
<div class="section level3">
<h3 id="fit-all-combinations-of-polynomials">Fit all combinations of polynomials<a class="anchor" aria-label="anchor" href="#fit-all-combinations-of-polynomials"></a>
</h3>
<p>The function dh.lmeMultPoly takes as an input to the argument
“formulae” a vector of formulae. Here we use the formulae created above.
You could also create your own vector of formulae and supply it to the
same argument.</p>
<p>If you’ve read Rachel Hughes’ paper, you’ll notice that she first
fits models on a discovery sample, and then checks the fit on the
remaining sample. I’ve skipped this here for simplicity but it is
possible to do this in DS.</p>
<p>This will take a few minutes as we are fitting 28 different
models.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.lmeMultPoly.html">dh.lmeMultPoly</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>    formulae <span class="op">=</span> <span class="va">weight_form</span><span class="op">$</span><span class="va">formulae</span>, </span>
<span>  poly_names <span class="op">=</span> <span class="va">weight_form</span><span class="op">$</span><span class="va">polys</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.lmeMultPoly(df = "data", formulae = weight_form$formulae, : object 'weight_form' not found</span></span></code></pre>
<p>There are some converegence warnings. We can see details here:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly.fit</span><span class="op">$</span><span class="va">convergence</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'poly.fit' not found</span></span></code></pre>
<p>The output contains a table with the negative log likelihood for each
model in each study, the average rank of that model across all studies
and the summed negative log likelihood. The model with the lowest summed
log-likelhood across studies contains two powers: age^0.5 &amp;
age^2.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly.fit</span><span class="op">$</span><span class="va">fit</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'poly.fit' not found</span></span></code></pre>
<p>In this scenario we are trying to fit the same model to all cohorts.
In other scenarioes you might want to fit a different model to different
cohorts. You could still use this table as a reference for the best
fitting model, for example for alspac:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poly.fit</span><span class="op">$</span><span class="va">fit</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">select</span><span class="op">(</span><span class="va">model</span>, <span class="va">alspac</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">alspac</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in select(., model, alspac): object 'poly.fit' not found</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="final-model">Final model<a class="anchor" aria-label="anchor" href="#final-model"></a>
</h3>
<p>Ok, so we’ve got an idea what the best fitting combination of age
terms will be. Now we can fit our final model, including sex and the
interaction with the age terms. We aren’t worrying about other
covariates in this example, but of course you could include them.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.lmerSLMA.html" class="external-link">ds.lmerSLMA</a></span><span class="op">(</span></span>
<span>    dataName <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  formula <span class="op">=</span> <span class="st">"weight ~ 1 + age0_5 + age2 + sex + age0_5*sex + age2*sex + (1|id_int)"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: There are some DataSHIELD errors, list them with datashield.errors()</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="making-plots">Making plots<a class="anchor" aria-label="anchor" href="#making-plots"></a>
</h3>
<p>Now we can go through the same process as above to make our plot.
Again, we need to create our age transformations in the new data to get
the predicted values for weight at each age.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_ref_final_m</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>    age0_5 <span class="op">=</span> <span class="va">age</span><span class="op">^</span><span class="fl">0.5</span>,</span>
<span>    age2 <span class="op">=</span> <span class="va">age</span><span class="op">^</span><span class="fl">2</span>, </span>
<span>    sex1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"age0_5:sex1"</span> <span class="op">=</span> <span class="va">age0_5</span><span class="op">*</span><span class="va">sex1</span>, </span>
<span>  <span class="st">"age2:sex1"</span> <span class="op">=</span> <span class="va">age2</span><span class="op">*</span><span class="va">sex1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_ref_final_f</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>    age0_5 <span class="op">=</span> <span class="va">age</span><span class="op">^</span><span class="fl">0.5</span>,</span>
<span>    age2 <span class="op">=</span> <span class="va">age</span><span class="op">^</span><span class="fl">2</span>, </span>
<span>    sex1 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="st">"age0_5:sex1"</span> <span class="op">=</span> <span class="va">age0_5</span><span class="op">*</span><span class="va">sex1</span>, </span>
<span>  <span class="st">"age2:sex1"</span> <span class="op">=</span> <span class="va">age2</span><span class="op">*</span><span class="va">sex1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred_ref_final</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">pred_ref_final_m</span>, <span class="va">pred_ref_final_f</span><span class="op">)</span></span></code></pre></div>
<p>Again we get the predicted values, trim them at the ages of the
observed data and set sex as a factor.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_ref_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.predictLmer.html">dh.predictLmer</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">final.fit</span>,</span>
<span>    newdata <span class="op">=</span> <span class="va">pred_ref_final</span>,</span>
<span>    coh_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">conns</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dh.predictLmer(model = final.fit, newdata = pred_ref_final, coh_names = names(conns)): object 'final.fit' not found</span></span></code></pre>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_ref_final_trim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.trimPredData.html">dh.trimPredData</a></span><span class="op">(</span></span>
<span>    pred <span class="op">=</span> <span class="va">pred_ref_final</span>,</span>
<span>    coh_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alspac"</span>, <span class="st">"bcg"</span>, <span class="st">"bib"</span>, <span class="st">"probit"</span>, <span class="st">"combined"</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in `pmap()`:</span></span>
<span><span class="co">## ℹ In index: 1.</span></span>
<span><span class="co">## Caused by error in `dplyr::filter()`:</span></span>
<span><span class="co">## ℹ In argument: `cohort == coh_ref &amp; between(age, min, max)`.</span></span>
<span><span class="co">## Caused by error:</span></span>
<span><span class="co">## ! `..1` must be of size 502 or 1, not size 0.</span></span></code></pre>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_ref_final_trim</span> <span class="op">&lt;-</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">mutate</span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sex1</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in mutate(., sex = factor(sex1, levels = c(0, 1), labels = c("Male", : object 'pred_ref_final_trim' not found</span></span></code></pre>
<p>And now we can make some plots</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">sample_frac</span><span class="op">(</span><span class="va">observed</span>, <span class="fl">.01</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">predicted</span>, colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">==</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Child age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Predicted weight (KG)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in sample_frac(observed, 0.01): object 'observed' not found</span></span></code></pre>
<p>We can also plot the trajectories by cohort</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu">sample_frac</span><span class="op">(</span><span class="va">observed</span>, <span class="fl">.01</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">weight</span><span class="op">)</span>, </span>
<span>    alpha <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">predicted</span>, colour <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort</span> <span class="op">!=</span> <span class="st">"combined"</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span>, </span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, ymin <span class="op">=</span> <span class="va">low_ci</span>, ymax <span class="op">=</span> <span class="va">upper_ci</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">cohort</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">5</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Child age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Predicted weight (KG)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in sample_frac(observed, 0.01): object 'observed' not found</span></span></code></pre>
<p>Great, this looks like a much better fit. We have captured the
initial growth, followed by a reduction in growth rate at age 5 followed
by an increase into adolescence.</p>
<p>This model still isn’t perfect - looking at the graph what problem
can you see?</p>
</div>
</div>
<div class="section level2">
<h2 id="checking-model-fit">Checking model fit<a class="anchor" aria-label="anchor" href="#checking-model-fit"></a>
</h2>
<p>The final step is to check how well the model fits at different age
points. Here we can approximate Table 2 from Tilling et al. (2014)
“Modelling Childhood Growth …”.</p>
<p>First we get mean observed values for weight between different age
bands. The ‘intervals’ argument specifies how we want to bin our age
variable. Again this takes a few minutes to run.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed_by_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dsHelper-defunct.html">dh.meanByAge</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>    outcome <span class="op">=</span> <span class="st">"weight"</span>, </span>
<span>    age_var <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>    intervals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">15</span>, <span class="fl">16</span>, <span class="fl">18</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: 'dh.meanByAge' has been removed from this package. </span></span>
<span><span class="co">##     Use dh.meanByAge instead. See help('Defunct')</span></span></code></pre>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed_by_age</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'observed_by_age' not found</span></span></code></pre>
<p>We rename our column to ‘observed’:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">observed_by_age</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>observed <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in dplyr::rename(., observed = mean): object 'observed_by_age' not found</span></span></code></pre>
<p>Now we get the average predicted values between the same age
bands</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_by_age</span> <span class="op">&lt;-</span> <span class="va">pred_ref_final_trim</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">mutate</span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>        <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"0_1"</span>, </span>
<span>        <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"1_2"</span>, </span>
<span>        <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"3_5"</span>, </span>
<span>        <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">6</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"6_10"</span>, </span>
<span>        <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">11</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">15</span> <span class="op">~</span> <span class="st">"11_15"</span>, </span>
<span>        <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">16</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">18</span> <span class="op">~</span> <span class="st">"16_18"</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">group_by</span><span class="op">(</span><span class="va">group</span>, <span class="va">cohort</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">summarise</span><span class="op">(</span></span>
<span>    predicted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    low_ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">low_ci</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    upper_ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">upper_ci</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in mutate(., group = case_when(age &gt; 0 &amp; age &lt;= 1 ~ "0_1", age &gt;= : object 'pred_ref_final_trim' not found</span></span></code></pre>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_by_age</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'pred_by_age' not found</span></span></code></pre>
<p>Finally we join the observed and predicted values into one table, and
calculate the difference between the two. We can also use the confidence
intervals to calculate upper and lower bounds of the residual. You can
see that model fit isn’t great for PROBIT towards the extremes. For
other cohorts, the looks pretty good.</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_tab</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">obs</span>, <span class="va">pred_by_age</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="st">"cohort"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">mutate</span><span class="op">(</span></span>
<span>    difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">-</span> <span class="va">predicted</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    lower_res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">-</span> <span class="va">upper_ci</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    higher_res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">-</span> <span class="va">low_ci</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>        <span class="va">group</span>, </span>
<span>        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0_1"</span>, <span class="st">"1_2"</span>, <span class="st">"3_5"</span>, <span class="st">"6_10"</span>, <span class="st">"11_15"</span>, <span class="st">"16_18"</span><span class="op">)</span>,</span>
<span>        ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lower_res</span>, <span class="st">" to "</span>, <span class="va">higher_res</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">cohort</span>, <span class="va">observed</span>, <span class="va">predicted</span>, <span class="va">difference</span>, <span class="va">limits</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">arrange</span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">group_by</span><span class="op">(</span><span class="va">cohort</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span><span class="va">group_split</span> <span class="op">%&gt;%</span></span>
<span><span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">conns</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in left_join(obs, pred_by_age, by = c("group", "cohort")): object 'obs' not found</span></span></code></pre>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_tab</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'res_tab' not found</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tim Cadman.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
