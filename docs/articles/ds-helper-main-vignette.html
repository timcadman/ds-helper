<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Descriptive functions • dsHelper</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Descriptive functions">
<meta property="og:description" content="dsHelper">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsHelper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ds-helper-main-vignette.html">Descriptive functions</a>
    </li>
    <li>
      <a href="../articles/ds-helper-trajectories-vignette.html">Conducting mixed effect/trajectory analysis using DataSHIELD</a>
    </li>
    <li>
      <a href="../articles/TROUBLESHOOTING.html">Troubeshooting</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lifecycle-project/ds-helper/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Descriptive functions</h1>
                        <h4 data-toc-skip class="author">Tim Cadman</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lifecycle-project/ds-helper/blob/HEAD/vignettes/ds-helper-main-vignette.Rmd" class="external-link"><code>vignettes/ds-helper-main-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>ds-helper-main-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introducation">Introducation<a class="anchor" aria-label="anchor" href="#introducation"></a>
</h2>
<p>dsHelper contains a number of client-side functions designed to
simplify data manipulation and analysis using DataSHIELD. Functions are
grouped in the following families:</p>
<ul>
<li>Descriptive functions</li>
<li>Data manipulation functions</li>
<li>Utility functions</li>
<li>Functions for trajectory models</li>
</ul>
<p>This vignette demonstrates the first three families of function.
Functions to assist with trajectory/mixed effect analysis are described
in a separate tutorial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lifecycle-project/ds-helper/" class="external-link">dsHelper</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsBaseClient</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/molgenis/molgenis-r-datashield/" class="external-link">DSMolgenisArmadillo</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-simulated-data-based-on-lifecycle-variables">Data: simulated data based on LifeCycle variables<a class="anchor" aria-label="anchor" href="#data-simulated-data-based-on-lifecycle-variables"></a>
</h2>
<p>To demonstrate these functions we will use remote simulated data for
three cohorts: ALSPAC, BCG &amp; BiB.</p>
<p>If you are unsure how to log in, please consult the DataSHIELD
vignette: [link]</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://molgenis.github.io/molgenis-r-datashield/reference/armadillo.get_token.html" class="external-link">armadillo.get_token</a></span><span class="op">(</span><span class="st">"https://armadillo.test.molgenis.org"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>server <span class="op">=</span> <span class="st">"alspac"</span>,</span>
<span>url <span class="op">=</span> <span class="st">"https://armadillo.test.molgenis.org"</span>,</span>
<span>table <span class="op">=</span> <span class="st">"mlmalspac/tutorial/data"</span>,</span>
<span>token <span class="op">=</span> <span class="va">token</span>,</span>
<span>driver <span class="op">=</span> <span class="st">"ArmadilloDriver"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>server <span class="op">=</span> <span class="st">"bcg"</span>,</span>
<span>url <span class="op">=</span> <span class="st">"https://armadillo.test.molgenis.org"</span>,</span>
<span>table <span class="op">=</span> <span class="st">"mlmbcg/tutorial/data"</span>,</span>
<span>token <span class="op">=</span> <span class="va">token</span>,</span>
<span>driver <span class="op">=</span> <span class="st">"ArmadilloDriver"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>server <span class="op">=</span> <span class="st">"bib"</span>,</span>
<span>url <span class="op">=</span> <span class="st">"https://armadillo.test.molgenis.org"</span>,</span>
<span>table <span class="op">=</span> <span class="st">"mlmbib/tutorial/data"</span>,</span>
<span>token <span class="op">=</span> <span class="va">token</span>,</span>
<span>driver <span class="op">=</span> <span class="st">"ArmadilloDriver"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logindata</span> <span class="op">&lt;-</span> <span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span>logins <span class="op">=</span> <span class="va">logindata</span>, assign <span class="op">=</span> <span class="cn">TRUE</span>, symbol <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-manipulation-functions">Data manipulation functions<a class="anchor" aria-label="anchor" href="#data-manipulation-functions"></a>
</h2>
<div class="section level3">
<h3 id="rename-variables-with-dh-renamevars">Rename variables with dh.renameVars()<a class="anchor" aria-label="anchor" href="#rename-variables-with-dh-renamevars"></a>
</h3>
<p>dh.renameVars allows you to change the names of one or more variables
within a dataframe. For example, we can rename the variables “id”, and
“ethnicity” with simpler names:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.renameVars.html">dh.renameVars</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  current_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ethnicity"</span>, <span class="st">"pat_soc"</span><span class="op">)</span>, </span>
<span>  new_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race"</span>, <span class="st">"paternal_class"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="removing-columns-with-dh-dropcols">Removing columns with dh.dropCols()<a class="anchor" aria-label="anchor" href="#removing-columns-with-dh-dropcols"></a>
</h3>
<p>dh.dropCols allows you to remove columns from a dataframe. The
argument “type” allows you to specify whether to remove or to keep the
provided variables. For example, we can remove the column “mat_ed”:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.dropCols.html">dh.dropCols</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  vars <span class="op">=</span> <span class="st">"mat_ed"</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"remove"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we can just to keep certain columns and remove
everything else. In this example we keep the columns “sex”, “height_m”
and “ivf”:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.dropCols.html">dh.dropCols</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"weight"</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-strata-of-a-variable-with-dh-makestrata">Creating strata of a variable with dh.makeStrata()<a class="anchor" aria-label="anchor" href="#creating-strata-of-a-variable-with-dh-makestrata"></a>
</h3>
<p>A common scenario is when you have repeat measurements of a variable,
but want to create individual versions of that variable within different
age bands.</p>
<p>For example, you may have a dataset with repeat measurments of height
between ages 2-18. However, you want to create a new variable which is
height between ages 4-6. This is quite a long process in datashield, as
it involves creating a number of subsets. It is also necessary to deal
with situations where a subject has &gt;1 observation within the
specified period.</p>
<p>In the example below, we create two variables for child height
measured between (i) ages 4-6 and (ii) ages 7-10. Where children have
more than one observation in either window, we opt to take the earliest
measurement. This behaviour is controlled by the argument “mult_action”.
You can also choose to take (i) the latest variable, or (ii) the
variable closest to a particular time point. Finally, within each band
we choose to take values &gt;= to the lowest band, and &lt; the highest
band. This behaviour is controlled by the argument “band_action”. See
?dh.makeStrata for more information on the available arguments.</p>
<p>In this example it runs quite quickly, however if you are using many
cohorts with large datasets it can take a considerable amount of time
(30 - 60 min).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.makeStrata.html">dh.makeStrata</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  var_to_subset <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>  age_var <span class="op">=</span> <span class="st">"age"</span>, </span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>  mult_action <span class="op">=</span> <span class="st">"earliest"</span>,</span>
<span>  band_action <span class="op">=</span> <span class="st">"ge_l"</span>, </span>
<span>  id_var <span class="op">=</span> <span class="st">"id"</span>, </span>
<span>  new_obj <span class="op">=</span> <span class="st">"height_data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"height_data"</span><span class="op">)</span></span></code></pre></div>
<p>The created dataset contains 5 variables: the id variable, two
variables giving the height value within the specified bands (height_.6,
height_.10) and two variables giving the age of measurement for these
height variables (age.6, age.10).</p>
<p>We can then use ds.merge to join this dataframe back with our main
data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.merge.html" class="external-link">ds.merge</a></span><span class="op">(</span></span>
<span>  x.name <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  y.name <span class="op">=</span> <span class="st">"height_data"</span>, </span>
<span>  by.x <span class="op">=</span> <span class="st">"id"</span>, </span>
<span>  by.y <span class="op">=</span> <span class="st">"id"</span>, </span>
<span>  all.x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  newobj <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transforming-continuous-variable-to-interquartile-range-using-dh-makeiqr">Transforming continuous variable to interquartile range using
dh.makeIQR()<a class="anchor" aria-label="anchor" href="#transforming-continuous-variable-to-interquartile-range-using-dh-makeiqr"></a>
</h3>
<p>In some scenarios (e.g. when using an environmental exposures) we
want to standardise a continuous variable by transforming it by its
interquartile range. The formula is:</p>
<p>value(subject) / 75th percentile(sample) - 25th
percentile(sample)</p>
<p>When using data from multiple cohorts there are two options for the
denominator: (i) create IQR in each cohort using the interquartile range
in that cohort, (ii) create IQR in each cohort by using the combined
interquartile range across all cohorts. This is controlled by the
argument <code>type</code>.</p>
<p>In this example we transform child weight. The created variable will
have the suffix “iqr_c” if <code>type</code> is “separate” and “iqr_p”
if type = “pooled”.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.makeIQR.html">dh.makeIQR</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  vars <span class="op">=</span> <span class="st">"weight"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"separate"</span>,</span>
<span>  new_obj <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in match.arg(type): 'arg' should be one of "combine", "split"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"weight_iqr_c"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: The input object(s) weight_iqr_c is(are) not defined on one or more of the studies!</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="removing-objects-from-workspace-using-dh-tidyenv">Removing objects from workspace using dh.tidyEnv()<a class="anchor" aria-label="anchor" href="#removing-objects-from-workspace-using-dh-tidyenv"></a>
</h3>
<p>The DataSHIELD function <code><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.rm.html" class="external-link">ds.rm()</a></code> allows you to remove
single objects from your workspace. However, we may want to remove a
number of objects at once. Use the argument <code>type</code> to choose
whether to keep or remove the variables listed in <code>vars</code>.
Here we chose to keep “data” and remove everything else.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.tidyEnv.html">dh.tidyEnv</a></span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.ls.html" class="external-link">ds.ls</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="identifying-column-indices-using-dh-findvarsindex">Identifying column indices using dh.findVarsIndex<a class="anchor" aria-label="anchor" href="#identifying-column-indices-using-dh-findvarsindex"></a>
</h3>
<p>There are some occasions when we need to do know what column a set of
variables is. For example, the function ds.dataFrameSubset takes an
input for the argument <code>keep.cols</code> a vector column
positions.</p>
<p>Subsetting data frames by column number is highly susceptable to
breaking (e.g if you change the order of steps in a script). This
function allows you to identify the column numbers of a vector of column
names, like so:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.findVarsIndex.html">dh.findVarsIndex</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"weight"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="describing-data">Describing data<a class="anchor" aria-label="anchor" href="#describing-data"></a>
</h2>
<div class="section level3">
<h3 id="summarising-data-using-dh-getstats">Summarising data using dh.getStats()<a class="anchor" aria-label="anchor" href="#summarising-data-using-dh-getstats"></a>
</h3>
<p>The DataSHIELD functions <code>ds.summary</code> and
<code>ds.table</code> produce basic descriptive statistics. However,
they have a number of limitations: the output is not in a very useable
format, you can only specify one variable at a time, and they don’t
provide some information that we will likely need in manuscripts
(e.g. about missingness).</p>
<p>Here we describe multiple variables using dh.getStats():</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.getStats.html">dh.getStats</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"weight"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.colnames.html" class="external-link">ds.colnames</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span><span class="op">$</span><span class="va">categorical</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">variable</span>, <span class="va">cohort</span>, <span class="va">valid_n</span>, <span class="va">missing_n</span>, <span class="va">perc_missing</span><span class="op">)</span></span></code></pre></div>
<p>The output is a list of two tibbles, corresponding to categorical and
continuous variables. See the help file for a list of calculated figures
and stats.</p>
</div>
<div class="section level3">
<h3 id="extracting-model-coefficients-using-dh-lmtab">Extracting model coefficients using dh.lmTab<a class="anchor" aria-label="anchor" href="#extracting-model-coefficients-using-dh-lmtab"></a>
</h3>
<p>When we run simple linear regression models in DataSHIELD, the
coefficients are returned within a nested list. It can be a bit tricky
to manually extract these (e.g. to create a table or a plot). This
function extracts the coefficients from linear models and outputs them
in a tibble. It can also handle mixed-effect models and will also return
summaries of random effects.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.glm.html" class="external-link">ds.glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="st">"weight~age"</span>, data <span class="op">=</span> <span class="st">"data"</span>, family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/dh.lmTab.html">dh.lmTab</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">output</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"glm_ipd"</span>, </span>
<span>  direction <span class="op">=</span> <span class="st">"wide"</span>, </span>
<span>  ci_format  <span class="op">=</span> <span class="st">"separate"</span><span class="op">)</span></span></code></pre></div>
<p>For manuscripts we may want to include confidence intervals in
brackets after the point estimate. We can specify this with the argument
“ci_format”:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.lmTab.html">dh.lmTab</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">output</span>, </span>
<span>  type <span class="op">=</span> <span class="st">"glm_ipd"</span>, </span>
<span>  direction <span class="op">=</span> <span class="st">"wide"</span>, </span>
<span>  ci_format  <span class="op">=</span> <span class="st">"paste"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-class-of-data-using-dh-classdiscrepancy">Checking class of data using dh.classDiscrepancy()<a class="anchor" aria-label="anchor" href="#checking-class-of-data-using-dh-classdiscrepancy"></a>
</h3>
<p>In an ideal world all variables would have the same class in every
study. However due to mistakes in harmonisation (or your scripts!) this
may not be the case. The can cause problems because many DataSHIELD
functions require the input variable(s) to have the same class in all
studies.</p>
<p>Using dh.classDiscrepancy we can produce a tibble summarising the
class of variable(s) across multiple studies. If we leave the argument
<code>vars</code> empty we check the class of all variables. The column
“discrepancy” summarises whether there are differences across
studies.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.classDiscrepancy.html">dh.classDiscrepancy</a></span><span class="op">(</span>df <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-non-missing-data-using-dh-anydata">Checking non-missing data using dh.anyData()<a class="anchor" aria-label="anchor" href="#checking-non-missing-data-using-dh-anydata"></a>
</h3>
<p>When we perform analyses with multiple cohorts, we may want to use
the same set of covariates in all analyses. We can use dh.anyData() to
check which cohortsh have at least some data on given variables.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.anyData.html">dh.anyData</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"weight"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="creating-a-dataset-for-analysis-using-dh-definecases">Creating a dataset for analysis using dh.defineCases()<a class="anchor" aria-label="anchor" href="#creating-a-dataset-for-analysis-using-dh-definecases"></a>
</h2>
<p>Before starting analysis we often want to restrict the dataset to
subjects meeting certain criteria. In the first example, we create a
vector indicating whether each subject has complete data on the set of
variables age, sex and weight:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.defineCases.html">dh.defineCases</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"weight"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"all"</span>, </span>
<span>  new_obj <span class="op">=</span> <span class="st">"data_on_all_vars"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.table.html" class="external-link">ds.table</a></span><span class="op">(</span><span class="st">"data_on_all_vars"</span><span class="op">)</span><span class="op">$</span><span class="va">output.list</span><span class="op">$</span><span class="va">TABLE_rvar.by.study_counts</span></span></code></pre></div>
<p>The data we have here is not the best to illustrate this function, as
there is no missing data.</p>
<p>We can also check whether subjects have available data on
<em>any</em> of a set of variables:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.defineCases.html">dh.defineCases</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"weight"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"any"</span>, </span>
<span>  new_obj <span class="op">=</span> <span class="st">"data_on_any_vars"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.table.html" class="external-link">ds.table</a></span><span class="op">(</span><span class="st">"data_on_any_vars"</span><span class="op">)</span><span class="op">$</span><span class="va">output.list</span><span class="op">$</span><span class="va">TABLE_rvar.by.study_counts</span></span></code></pre></div>
<p>Again, we can’t see the differences because all subjects have data on
all variables. However, lets assume that we want to create an subset of
our data restricted to participants with data on at least one of these
variables. We can then use ds.dataFrameSubset in conjuncture with the
vector we created:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.dataFrameSubset.html" class="external-link">ds.dataFrameSubset</a></span><span class="op">(</span></span>
<span>  df.name <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  V1.name <span class="op">=</span> <span class="st">"data_on_any_vars"</span>, </span>
<span>  V2.name <span class="op">=</span> <span class="st">"1"</span>, </span>
<span>  Boolean.operator <span class="op">=</span> <span class="st">"=="</span>, </span>
<span>  newobj <span class="op">=</span> <span class="st">"analysis_df"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="miscellaneous-functions">Miscellaneous functions<a class="anchor" aria-label="anchor" href="#miscellaneous-functions"></a>
</h2>
<div class="section level3">
<h3 id="enabling-auto-complete-functionality-within-r-studio-">Enabling auto-complete functionality within R Studio.<a class="anchor" aria-label="anchor" href="#enabling-auto-complete-functionality-within-r-studio-"></a>
</h3>
<p>When using R studio with native R, auto-complete suggestions will
appear for variables within a data frame. However, by default these
won’t appear for variables within a serverside data frame.</p>
<p>We can get round this by creating a local object with the same
structure as the remote object. Once you have run this function,
autocomplete options for the data frame “data” should now be
available.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dh.localProxy.html">dh.localProxy</a></span><span class="op">(</span>df <span class="op">=</span> <span class="st">"data"</span>, conns <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="manually-pooling-estimates-by-meta-analysis">Manually pooling estimates by meta-analysis<a class="anchor" aria-label="anchor" href="#manually-pooling-estimates-by-meta-analysis"></a>
</h3>
<p>Most of the time the meta-analysis functions in DataSHIELD
(e.g. ds.glmSLMA) will be sufficient. However, you may sometimes need
additional flexibility with meta-analysis. For example, currently
ds.glmSLMA doesn’t return heterogeneity statistics.</p>
<p>This functions takes vectors of coefficients and standard errors from
multiple cohorts and meta-analyses them.</p>
<p>First we fit a model in different cohorts and extract the
coefficients:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.glmSLMA.html" class="external-link">ds.glmSLMA</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="st">"weight~age"</span>, </span>
<span>  dataName <span class="op">=</span> <span class="st">"data"</span>, </span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can use this object and to the meta-analysis manually:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_analysed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dh.metaManual.html">dh.metaManual</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">output</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ML"</span><span class="op">)</span></span></code></pre></div>
<p>The output consists of a list with two elements. The first element
(“model”) is a list with the output from metafor. The length will be the
number of variables meta-analysed:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meta_analysed</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p>The second element (“coefficients”) is a summary table:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_analysed</span><span class="op">$</span><span class="va">coefs</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tim Cadman.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
