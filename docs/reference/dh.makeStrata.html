<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Creates strata of a repeated measures variable within specified age or time
bands — dh.makeStrata • dsHelper</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Creates strata of a repeated measures variable within specified age or time
bands — dh.makeStrata"><meta property="og:description" content="For many analyses you may want to create strata of repeated measures data
within specified bands. For example, you may have BMI measures between ages
0-18, but want to create a variable for each subject which is their BMI
between ages 9-11. This function automates this process."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsHelper</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ds-helper-main-vignette.html">Descriptive functions</a>
    </li>
    <li>
      <a href="../articles/ds-helper-trajectories-vignette.html">Conducting mixed effect/trajectory analysis using DataSHIELD</a>
    </li>
    <li>
      <a href="../articles/TROUBLESHOOTING.html">Troubeshooting</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/lifecycle-project/ds-helper/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Creates strata of a repeated measures variable within specified age or time
bands</h1>
    <small class="dont-index">Source: <a href="https://github.com/lifecycle-project/ds-helper/blob/HEAD/R/make-strata.R" class="external-link"><code>R/make-strata.R</code></a></small>
    <div class="hidden name"><code>dh.makeStrata.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For many analyses you may want to create strata of repeated measures data
within specified bands. For example, you may have BMI measures between ages
0-18, but want to create a variable for each subject which is their BMI
between ages 9-11. This function automates this process.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dh.makeStrata</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  id_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  age_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_to_subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bands <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mult_action <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mult_vals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  keep_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  new_obj <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  band_action <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  df_name <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df</dt>
<dd><p>Character specifying a server-side data frame.</p></dd>


<dt>id_var</dt>
<dd><p>Character giving the name of the column within `df` which 
uniquely identifies each subject.</p></dd>


<dt>age_var</dt>
<dd><p>Character specifying age or time variable in <code>df</code>.</p></dd>


<dt>var_to_subset</dt>
<dd><p>Character specifying variable in <code>df</code> to stratify
according to bands.</p></dd>


<dt>bands</dt>
<dd><p>Numeric vector of alternating lower and upper values specifying
the bands in which to derive strata of <code>var_to_subset</code>. This vector should
be an even number and twice the length of the number of bands required.</p></dd>


<dt>mult_action</dt>
<dd><p>Character specifying how to handle cases where a subject
has more than one measurement within a specified band. Use "earliest" to
take the earliest measurement, "latest" to take the latest measurement and
"nearest" to take the measurement nearest to the value(s) specified in
<code>mult_vals</code>.</p></dd>


<dt>mult_vals</dt>
<dd><p>Numeric vector specifying the value in each age band to
chose values closest to if subjects have more than one value per band.
Required only if mult_action is "nearest". The order and length of the vector
should correspond to the order and number of the bands.</p></dd>


<dt>keep_vars</dt>
<dd><p>Optionally, a vector of variable names within df to include
within each strata created.</p></dd>


<dt>new_obj</dt>
<dd><p>Character specifying name for created serverside object.</p></dd>


<dt>band_action</dt>
<dd><p>Character specifying how the values provided in <code>bands</code>
are evaluated in creating the strata:</p><ul><li><p>"g_l" = greater than the lowest band and less than the highest band</p></li>
<li><p>"ge_le" = greater or equal to the lowest band and less than or equal to the
highest band</p></li>
<li><p>"g_le" = greater than the lowest band and less than or equal to the highest
band</p></li>
<li><p>"ge_l" = greater than or equal to the lowest band and less than the highest
band</p></li>
</ul></dd>


<dt>conns</dt>
<dd><p>DataSHIELD connections object.</p></dd>


<dt>checks</dt>
<dd><p>Logical; if TRUE checks are performed prior to running the 
function. Default is TRUE.</p></dd>


<dt>df_name</dt>
<dd><p>Retired argument name. Please use `new_obj' instead.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Servside dataframe in wide format containing the derived variables.
For each band specified at least two variables will be returned:</p><ul><li><p>var_to_subset</p></li>
<li><p>age_var.
The suffix .lower_band identifies the band for that variable.</p></li>
</ul><p>If argument <code>keep_vars</code> is not NULL, then additional variables will be
added to the data frame representing these variables within the strata
created.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The steps here are equivalent to the following dplyr chain:</p>
<p>df %&gt;%
group_by(band, id) %&gt;%
arrange() %&lt;%
slice(1)</p>
<p>One of the complexities of this operation is how to deal with cases where
subjects have multiple observations within a specified band. This is handled
by first sorting the group so that the required value is first. When the
data is reshaped to wide format all but the first value for subjects with
multiple observations within a band are dropped.</p>
<p>Note that for big datasets this will take a long time to run.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other data manipulation functions: 
<code><a href="dh.dropCols.html">dh.dropCols</a>()</code>,
<code><a href="dh.makeAgePolys.html">dh.makeAgePolys</a>()</code>,
<code><a href="dh.makeIQR.html">dh.makeIQR</a>()</code>,
<code><a href="dh.quartileSplit.html">dh.quartileSplit</a>()</code>,
<code><a href="dh.renameVars.html">dh.renameVars</a>()</code>,
<code><a href="dh.tidyEnv.html">dh.tidyEnv</a>()</code>,
<code><a href="dh.zByGroup.html">dh.zByGroup</a>()</code></p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tim Cadman.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

